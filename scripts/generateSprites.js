/* eslint-disable import/no-commonjs */
const axios = require('axios');
const dex = require('pokemagic/dex');
const fs = require('fs');
const path = require('path');

// How to:
//
// Once you have all of the images inside assets/sprites in the format of
// pokemon_name_lowercase.png, you can run this script with node and it'll
// generate the file `src/sprites.js`.

// Sprite URL
// https://img.pokemondb.net/sprites/black-white/normal/entei.png
// https://img.pokemondb.net/sprites/sun-moon/dex/normal/raichu-alolan.png
// https://img.pokemondb.net/sprites/black-white/normal/giratina-altered.png

function URL(basename) {
//  return `https://img.pokemondb.net/sprites/black-white/normal/${basename}`;
  return `https://img.pokemondb.net/sprites/omega-ruby-alpha-sapphire/dex/normal/${basename}`;
}


const missingSprites = [];
const lines = [];
dex.getAllPokemon().forEach(({ form, id, name }) => {
  const spritePath = `../assets/sprites/${(form || name).toLowerCase()}.png`;
  if (!fs.existsSync(spritePath.slice(1))) {
    missingSprites.push(spritePath);
    return null;
  }

  lines.push(`${id}: require('${spritePath}'),`);
});

if (missingSprites.length) {
  const p = missingSprites.reduce((p, spritePath) => {
    return p.then(() => {
      const basename = path.basename(spritePath)
        .replace('_', '-')
        .replace('cherrim-sunny', 'cherrim-sunshine')
        .replace('east_sea', 'east')
        .replace('west_sea', 'west');
      const fullPath = path.resolve(path.join(__dirname, spritePath));
      return axios.get(URL(basename), {
        responseType: 'arraybuffer',
      }).then((res) => {
        fs.writeFileSync(fullPath, res.data);
      });
    });
  }, Promise.resolve());

  p.then(() => {
    console.log('Done pulling down new sprites, please run this script again.');
  }).catch((err) => console.error(err));
}

const data = `// THIS FILE IS AUTOMATICALLY GENERATED. PLEASE SEE scripts/generateSprites.js
export default {
  ${lines.join('\n  ')}
};`;

fs.writeFileSync('./src/sprites.js', data, 'utf-8');
